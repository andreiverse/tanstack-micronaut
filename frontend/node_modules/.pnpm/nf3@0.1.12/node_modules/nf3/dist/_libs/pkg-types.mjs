import{t as resolveModulePath}from"./exsolve.mjs";import{c as join,d as resolve,l as normalize,s as isAbsolute}from"./mlly.mjs";import{n as x,r as z,t as h}from"./confbox.mjs";import{promises,statSync}from"node:fs";import{fileURLToPath}from"node:url";import"node:fs/promises";const defaultFindOptions={startingFrom:`.`,rootPattern:/^node_modules$/,reverse:!1,test:e=>{try{if(statSync(e).isFile())return!0}catch{}}};async function findFile(e,f={}){let p=Array.isArray(e)?e:[e],m={...defaultFindOptions,...f},g=resolve(m.startingFrom),_=g[0]===`/`,v=g.split(`/`).filter(Boolean);if(p.includes(v.at(-1))&&await m.test(g))return g;_&&(v[0]=`/`+v[0]);let y=v.findIndex(e=>e.match(m.rootPattern));if(y===-1&&(y=0),m.reverse)for(let e=y+1;e<=v.length;e++)for(let d of p){let f=join(...v.slice(0,e),d);if(await m.test(f))return f}else for(let e=v.length;e>y;e--)for(let d of p){let f=join(...v.slice(0,e),d);if(await m.test(f))return f}throw Error(`Cannot find matching ${e} in ${m.startingFrom} or parent directories`)}function findNearestFile(e,u={}){return findFile(e,u)}function _resolvePath(u,d={}){return u instanceof URL||u.startsWith(`file://`)?normalize(fileURLToPath(u)):isAbsolute(u)?normalize(u):resolveModulePath(u,{...d,from:d.from||d.parent||d.url})}const FileCache=new Map;async function readPackageJSON(e,u={}){let d=await resolvePackageJSON(e,u),f=u.cache&&typeof u.cache!=`boolean`?u.cache:FileCache;if(u.cache&&f.has(d))return f.get(d);let p=await promises.readFile(d,`utf8`),g;try{g=x(p)}catch{g=h(p)}return f.set(d,g),g}async function writePackageJSON(e,u){await promises.writeFile(e,z(u))}async function resolvePackageJSON(e=process.cwd(),u={}){return findNearestFile(`package.json`,{...u,startingFrom:_resolvePath(e,u)})}export{writePackageJSON as n,readPackageJSON as t};