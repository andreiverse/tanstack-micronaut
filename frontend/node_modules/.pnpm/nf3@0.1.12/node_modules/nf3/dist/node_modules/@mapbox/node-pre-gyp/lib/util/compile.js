"use strict";module.exports=exports;const fs=require(`fs`),path=require(`path`),win=process.platform===`win32`,existsSync=fs.existsSync||path.existsSync,cp=require(`child_process`);function which_node_gyp(){let e;if(process.env.npm_config_node_gyp)try{if(e=process.env.npm_config_node_gyp,existsSync(e))return e}catch{}try{let i=require.resolve(`node-gyp`);if(e=path.join(path.dirname(path.dirname(i)),`bin/node-gyp.js`),existsSync(e))return e}catch{}if(process.execPath.indexOf(`iojs`)===-1)try{let i=require.resolve(`npm`);if(e=path.join(path.dirname(path.dirname(i)),`node_modules/node-gyp/bin/node-gyp.js`),existsSync(e))return e}catch{}let i=path.join(path.dirname(path.dirname(process.execPath)),`lib/node_modules/npm/`);if(e=path.join(i,`node_modules/node-gyp/bin/node-gyp.js`),existsSync(e))return e}module.exports.run_gyp=function(e,r,a){let o=``,s=[];if(r.runtime&&r.runtime===`node-webkit`)o=`nw-gyp`,win&&(o+=`.cmd`);else{let e=which_node_gyp();e?(o=process.execPath,s.push(e)):(o=`node-gyp`,win&&(o+=`.cmd`))}let c=s.concat(e),l=cp.spawn(o,c,{cwd:void 0,env:process.env,stdio:[0,1,2]});l.on(`error`,e=>{if(e)return a(Error(`Failed to execute '`+o+` `+c.join(` `)+`' (`+e+`)`));a(null,r)}),l.on(`close`,e=>{if(e&&e!==0)return a(Error(`Failed to execute '`+o+` `+c.join(` `)+`' (`+e+`)`));a(null,r)})};