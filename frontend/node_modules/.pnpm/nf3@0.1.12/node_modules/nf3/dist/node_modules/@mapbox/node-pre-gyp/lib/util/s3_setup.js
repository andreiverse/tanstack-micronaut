"use strict";module.exports=exports;const url=require(`url`),fs=require(`fs`),path=require(`path`);module.exports.detect=function(t){let n={},r=t.hosted_path,i=url.parse(r);if(t.bucket&&t.region){n.endpoint=t.host,n.bucket=t.bucket,n.region=t.region,n.s3ForcePathStyle=t.s3ForcePathStyle;let e=n.s3ForcePathStyle?`/${n.bucket}/`:`/`;n.prefix=!i.pathname||i.pathname===e?``:i.pathname.replace(e,``)}else{let e=i.hostname.split(`.s3`);if(e.length===1)throw Error(`Could not parse s3 bucket name from virtual host url.`);n.bucket=e[0];let t=e[1].slice(1).split(`.`)[0];t===`amazonaws`?n.region=`us-east-1`:n.region=t,n.prefix=!i.pathname||i.pathname===`/`?``:i.pathname.replace(`/`,``)}return n},module.exports.get_s3=function(e){if(process.env.node_pre_gyp_mock_s3){let e=require(`mock-aws-s3`),t=require(`os`);e.config.basePath=`${t.tmpdir()}/mock`;let n=e.S3(),r=e=>(t,...n)=>(t&&t.code===`ENOENT`&&(t.code=`NotFound`),e(t,...n));return{listObjects(e,t){return n.listObjects(e,r(t))},headObject(e,t){return n.headObject(e,r(t))},deleteObject(e,t){return n.deleteObject(e,r(t))},putObject(e,t){return n.putObject(e,r(t))}}}let t=require(`aws-sdk`);t.config.update(e);let n=new t.S3;return{listObjects(e,t){return n.listObjects(e,t)},headObject(e,t){return n.headObject(e,t)},deleteObject(e,t){return n.deleteObject(e,t)},putObject(e,t){return n.putObject(e,t)}}},module.exports.get_mockS3Http=function(){let e=!1;if(!process.env.node_pre_gyp_mock_s3)return()=>e;let r=require(`nock`),i=`https://mapbox-node-pre-gyp-public-testing-bucket.s3.us-east-1.amazonaws.com`,a=process.env.node_pre_gyp_mock_s3+`/mapbox-node-pre-gyp-public-testing-bucket`;return(()=>{function o(e,r){let i=path.join(a,e.replace(`%2B`,`+`));try{fs.accessSync(i,fs.constants.R_OK)}catch{return[404,`not found
`]}return[200,fs.createReadStream(i)]}return r(i).persist().get(()=>e).reply(o)})(r,i,a),t=>{let n=e;if(t===`off`)e=!1;else if(t===`on`)e=!0;else if(t!==`get`)throw Error(`illegal action for setMockHttp ${t}`);return n}};