"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.importAttributesOrAssertions=exports.importAttributes=exports.importAssertions=void 0;var _acorn=_interopRequireWildcard(require(`acorn`));function _getRequireWildcardCache(e){if(typeof WeakMap!=`function`)return null;var o=new WeakMap,s=new WeakMap;return(_getRequireWildcardCache=function(e){return e?s:o})(e)}function _interopRequireWildcard(e,o){if(!o&&e&&e.__esModule)return e;if(e===null||typeof e!=`object`&&typeof e!=`function`)return{default:e};var s=_getRequireWildcardCache(o);if(s&&s.has(e))return s.get(e);var c={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!==`default`&&{}.hasOwnProperty.call(e,u)){var d=l?Object.getOwnPropertyDescriptor(e,u):null;d&&(d.get||d.set)?Object.defineProperty(c,u,d):c[u]=e[u]}return c.default=e,s&&s.set(e,c),c}const leftCurlyBrace=123,space=32,withKeyword=`with`,assertKeyword=`assert`,FUNC_STATEMENT=1,FUNC_HANGING_STATEMENT=2,FUNC_NULLABLE_ID=4,importAttributes=exports.importAttributes=plugin({keyword:`with`}),importAssertions=exports.importAssertions=plugin({keyword:`assert`}),importAttributesOrAssertions=exports.importAttributesOrAssertions=plugin({keyword:`with-assert`});function plugin(e){return function(a){return pluginImpl(e,a)}}function pluginImpl(a,o){let{tokTypes:s,TokenType:c}=o.acorn||_acorn,{keyword:d}=a,f=d.includes(withKeyword),p=d.includes(assertKeyword),m=f&&p;return class extends o{constructor(...e){super(...e),this.withToken=f&&new c(withKeyword),this.assertToken=p&&new c(assertKeyword)}_codeAt(e){return this.input.charCodeAt(e)}_eat(e){this.type!==e&&this.unexpected(),this.next()}_matchKeywordToken(){return m&&(this.type===this.withToken||this.type===this.assertToken)||f&&this.type===this.withToken||p&&this.type===this.assertToken}_getProperty(){return m?this.type===this.withToken?`attributes`:`assertions`:f?`attributes`:`assertions`}readToken(e){let a=0,o,s;if(m){if(this.input.slice(this.pos,this.pos+4)===withKeyword)o=withKeyword,s=this.withToken;else if(this.input.slice(this.pos,this.pos+6)===assertKeyword)o=assertKeyword,s=this.assertToken;else return super.readToken(e);a+=o.length}else for(o=f?withKeyword:assertKeyword,s=f?this.withToken:this.assertToken;a<o.length;a++)if(this._codeAt(this.pos+a)!==o.charCodeAt(a))return super.readToken(e);for(;this._codeAt(this.pos+a)!==123;a++)if(this._codeAt(this.pos+a)!==32)return super.readToken(e);return this.type.label===`{`?super.readToken(e):(this.pos+=o.length,this.finishToken(s))}parseDynamicImport(e){return this.next(),e.source=this.parseMaybeAssign(),this.eat(s.comma)&&(e.arguments=[this.parseExpression()]),this._eat(s.parenR),this.finishNode(e,`ImportExpression`)}parseExport(e,a){if(this.next(),this.eat(s.star)){if(this.options.ecmaVersion>=11&&(this.eatContextual(`as`)?(e.exported=this.parseIdent(!0),this.checkExport(a,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual(`from`),this.type!==s.string&&this.unexpected(),e.source=this.parseExprAtom(),this._matchKeywordToken()){let a=this._getProperty();this.next();let o=this.parseImportAttributes();o&&(e[a]=o)}return this.semicolon(),this.finishNode(e,`ExportAllDeclaration`)}if(this.eat(s._default)){this.checkExport(a,`default`,this.lastTokStart);var o;if(this.type===s._function||(o=this.isAsyncFunction())){var c=this.startNode();this.next(),o&&this.next(),e.declaration=this.parseFunction(c,5,!1,o)}else if(this.type===s._class){var l=this.startNode();e.declaration=this.parseClass(l,`nullableID`)}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,`ExportDefaultDeclaration`)}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),e.declaration.type===`VariableDeclaration`?this.checkVariableExport(a,e.declaration.declarations):this.checkExport(a,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(a),this.eatContextual(`from`)){if(this.type!==s.string&&this.unexpected(),e.source=this.parseExprAtom(),this._matchKeywordToken()){let a=this._getProperty();this.next();let o=this.parseImportAttributes();o&&(e[a]=o)}}else{for(var u=0,d=e.specifiers;u<d.length;u+=1){var f=d[u];this.checkUnreserved(f.local),this.checkLocalExport(f.local)}e.source=null}this.semicolon()}return this.finishNode(e,`ExportNamedDeclaration`)}parseImport(e){if(this.next(),this.type===s.string?(e.specifiers=[],e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual(`from`),e.source=this.type===s.string?this.parseExprAtom():this.unexpected()),this._matchKeywordToken()){let a=this._getProperty();this.next();let o=this.parseImportAttributes();o&&(e[a]=o)}return this.semicolon(),this.finishNode(e,`ImportDeclaration`)}parseImportAttributes(){this._eat(s.braceL);let e=this.parsewithEntries();return this._eat(s.braceR),e}parsewithEntries(){let e=[],a=new Set;do{if(this.type===s.braceR)break;let o=this.startNode(),c;c=this.type===s.string?this.parseLiteral(this.value):this.parseIdent(!0),this.next(),o.key=c,a.has(o.key.name)&&this.raise(this.pos,`Duplicated key in attributes`),a.add(o.key.name),this.type!==s.string&&this.raise(this.pos,`Only string is supported as an attribute value`),o.value=this.parseLiteral(this.value),e.push(this.finishNode(o,`ImportAttribute`))}while(this.eat(s.comma));return e}}}