"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.Glob=void 0;const minimatch_1=require(`minimatch`),node_url_1=require(`node:url`),path_scurry_1=require(`path-scurry`),pattern_js_1=require(`./pattern.js`),walker_js_1=require(`./walker.js`),defaultPlatform=typeof process==`object`&&process&&typeof process.platform==`string`?process.platform:`linux`;class Glob{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(a,o){if(!o)throw TypeError(`glob options required`);if(this.withFileTypes=!!o.withFileTypes,this.signal=o.signal,this.follow=!!o.follow,this.dot=!!o.dot,this.dotRelative=!!o.dotRelative,this.nodir=!!o.nodir,this.mark=!!o.mark,o.cwd?(o.cwd instanceof URL||o.cwd.startsWith(`file://`))&&(o.cwd=(0,node_url_1.fileURLToPath)(o.cwd)):this.cwd=``,this.cwd=o.cwd||``,this.root=o.root,this.magicalBraces=!!o.magicalBraces,this.nobrace=!!o.nobrace,this.noext=!!o.noext,this.realpath=!!o.realpath,this.absolute=o.absolute,this.includeChildMatches=o.includeChildMatches!==!1,this.noglobstar=!!o.noglobstar,this.matchBase=!!o.matchBase,this.maxDepth=typeof o.maxDepth==`number`?o.maxDepth:1/0,this.stat=!!o.stat,this.ignore=o.ignore,this.withFileTypes&&this.absolute!==void 0)throw Error(`cannot set absolute and withFileTypes:true`);if(typeof a==`string`&&(a=[a]),this.windowsPathsNoEscape=!!o.windowsPathsNoEscape||o.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(a=a.map(e=>e.replace(/\\/g,`/`))),this.matchBase){if(o.noglobstar)throw TypeError(`base matching requires globstar`);a=a.map(e=>e.includes(`/`)?e:`./**/${e}`)}if(this.pattern=a,this.platform=o.platform||defaultPlatform,this.opts={...o,platform:this.platform},o.scurry){if(this.scurry=o.scurry,o.nocase!==void 0&&o.nocase!==o.scurry.nocase)throw Error(`nocase option contradicts provided scurry option`)}else this.scurry=new(o.platform===`win32`?path_scurry_1.PathScurryWin32:o.platform===`darwin`?path_scurry_1.PathScurryDarwin:o.platform?path_scurry_1.PathScurryPosix:path_scurry_1.PathScurry)(this.cwd,{nocase:o.nocase,fs:o.fs});this.nocase=this.scurry.nocase;let s=this.platform===`darwin`||this.platform===`win32`,c={...o,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:s,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},[l,u]=this.pattern.map(r=>new minimatch_1.Minimatch(r,c)).reduce((e,r)=>(e[0].push(...r.set),e[1].push(...r.globParts),e),[[],[]]);this.patterns=l.map((e,r)=>{let i=u[r];if(!i)throw Error(`invalid pattern object`);return new pattern_js_1.Pattern(e,i,0,this.platform)})}async walk(){return[...await new walker_js_1.GlobWalker(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new walker_js_1.GlobWalker(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new walker_js_1.GlobStream(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new walker_js_1.GlobStream(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}exports.Glob=Glob;