"use strict";var __createBinding=this&&this.__createBinding||(Object.create?(function(o,A,j,M){M===void 0&&(M=j);var N=Object.getOwnPropertyDescriptor(A,j);(!N||(`get`in N?!A.__esModule:N.writable||N.configurable))&&(N={enumerable:!0,get:function(){return A[j]}}),Object.defineProperty(o,M,N)}):(function(o,A,j,M){M===void 0&&(M=j),o[M]=A[j]})),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?(function(o,A){Object.defineProperty(o,`default`,{enumerable:!0,value:A})}):function(o,A){o.default=A}),__importStar=this&&this.__importStar||function(j){if(j&&j.__esModule)return j;var M={};if(j!=null)for(var N in j)N!==`default`&&Object.prototype.hasOwnProperty.call(j,N)&&__createBinding(M,j,N);return __setModuleDefault(M,j),M};Object.defineProperty(exports,`__esModule`,{value:!0}),exports.PathScurry=exports.Path=exports.PathScurryDarwin=exports.PathScurryPosix=exports.PathScurryWin32=exports.PathScurryBase=exports.PathPosix=exports.PathWin32=exports.PathBase=exports.ChildrenCache=exports.ResolveCache=void 0;const lru_cache_1=require(`lru-cache`),node_path_1=require(`node:path`),node_url_1=require(`node:url`),fs_1=require(`fs`),actualFS=__importStar(require(`node:fs`)),realpathSync=fs_1.realpathSync.native,promises_1=require(`node:fs/promises`),minipass_1=require(`minipass`),defaultFS={lstatSync:fs_1.lstatSync,readdir:fs_1.readdir,readdirSync:fs_1.readdirSync,readlinkSync:fs_1.readlinkSync,realpathSync,promises:{lstat:promises_1.lstat,readdir:promises_1.readdir,readlink:promises_1.readlink,realpath:promises_1.realpath}},fsFromOption=o=>!o||o===defaultFS||o===actualFS?defaultFS:{...defaultFS,...o,promises:{...defaultFS.promises,...o.promises||{}}},uncDriveRegexp=/^\\\\\?\\([a-z]:)\\?$/i,uncToDrive=o=>o.replace(/\//g,`\\`).replace(uncDriveRegexp,`$1\\`),eitherSep=/[\\\/]/,UNKNOWN=0,IFIFO=1,IFCHR=2,IFDIR=4,IFBLK=6,IFREG=8,IFLNK=10,IFSOCK=12,IFMT=15,IFMT_UNKNOWN=-16,READDIR_CALLED=16,LSTAT_CALLED=32,ENOTDIR=64,ENOENT=128,ENOREADLINK=256,ENOREALPATH=512,ENOCHILD=704,TYPEMASK=1023,entToType=o=>o.isFile()?8:o.isDirectory()?4:o.isSymbolicLink()?10:o.isCharacterDevice()?2:o.isBlockDevice()?6:o.isSocket()?12:o.isFIFO()?1:0,normalizeCache=new Map,normalize=o=>{let A=normalizeCache.get(o);if(A)return A;let j=o.normalize(`NFKD`);return normalizeCache.set(o,j),j},normalizeNocaseCache=new Map,normalizeNocase=o=>{let A=normalizeNocaseCache.get(o);if(A)return A;let j=normalize(o.toLowerCase());return normalizeNocaseCache.set(o,j),j};class ResolveCache extends lru_cache_1.LRUCache{constructor(){super({max:256})}}exports.ResolveCache=ResolveCache;class ChildrenCache extends lru_cache_1.LRUCache{constructor(o=16*1024){super({maxSize:o,sizeCalculation:o=>o.length+1})}}exports.ChildrenCache=ChildrenCache;const setAsCwd=Symbol(`PathScurry setAsCwd`);class PathBase{name;root;roots;parent;nocase;isCWD=!1;#fs;#dev;get dev(){return this.#dev}#mode;get mode(){return this.#mode}#nlink;get nlink(){return this.#nlink}#uid;get uid(){return this.#uid}#gid;get gid(){return this.#gid}#rdev;get rdev(){return this.#rdev}#blksize;get blksize(){return this.#blksize}#ino;get ino(){return this.#ino}#size;get size(){return this.#size}#blocks;get blocks(){return this.#blocks}#atimeMs;get atimeMs(){return this.#atimeMs}#mtimeMs;get mtimeMs(){return this.#mtimeMs}#ctimeMs;get ctimeMs(){return this.#ctimeMs}#birthtimeMs;get birthtimeMs(){return this.#birthtimeMs}#atime;get atime(){return this.#atime}#mtime;get mtime(){return this.#mtime}#ctime;get ctime(){return this.#ctime}#birthtime;get birthtime(){return this.#birthtime}#matchName;#depth;#fullpath;#fullpathPosix;#relative;#relativePosix;#type;#children;#linkTarget;#realpath;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(o,A=0,j,M,N,P,F){this.name=o,this.#matchName=N?normalizeNocase(o):normalize(o),this.#type=A&1023,this.nocase=N,this.roots=M,this.root=j||this,this.#children=P,this.#fullpath=F.fullpath,this.#relative=F.relative,this.#relativePosix=F.relativePosix,this.parent=F.parent,this.parent?this.#fs=this.parent.#fs:this.#fs=fsFromOption(F.fs)}depth(){return this.#depth===void 0?this.parent?this.#depth=this.parent.depth()+1:this.#depth=0:this.#depth}childrenCache(){return this.#children}resolve(o){if(!o)return this;let A=this.getRootString(o),j=o.substring(A.length).split(this.splitSep);return A?this.getRoot(A).#resolveParts(j):this.#resolveParts(j)}#resolveParts(o){let A=this;for(let j of o)A=A.child(j);return A}children(){let o=this.#children.get(this);if(o)return o;let A=Object.assign([],{provisional:0});return this.#children.set(this,A),this.#type&=-17,A}child(o,A){if(o===``||o===`.`)return this;if(o===`..`)return this.parent||this;let j=this.children(),M=this.nocase?normalizeNocase(o):normalize(o);for(let o of j)if(o.#matchName===M)return o;let N=this.parent?this.sep:``,P=this.#fullpath?this.#fullpath+N+o:void 0,F=this.newChild(o,0,{...A,parent:this,fullpath:P});return this.canReaddir()||(F.#type|=128),j.push(F),F}relative(){if(this.isCWD)return``;if(this.#relative!==void 0)return this.#relative;let o=this.name,A=this.parent;if(!A)return this.#relative=this.name;let j=A.relative();return j+(!j||!A.parent?``:this.sep)+o}relativePosix(){if(this.sep===`/`)return this.relative();if(this.isCWD)return``;if(this.#relativePosix!==void 0)return this.#relativePosix;let o=this.name,A=this.parent;if(!A)return this.#relativePosix=this.fullpathPosix();let j=A.relativePosix();return j+(!j||!A.parent?``:`/`)+o}fullpath(){if(this.#fullpath!==void 0)return this.#fullpath;let o=this.name,A=this.parent;return A?this.#fullpath=A.fullpath()+(A.parent?this.sep:``)+o:this.#fullpath=this.name}fullpathPosix(){if(this.#fullpathPosix!==void 0)return this.#fullpathPosix;if(this.sep===`/`)return this.#fullpathPosix=this.fullpath();if(!this.parent){let o=this.fullpath().replace(/\\/g,`/`);return/^[a-z]:\//i.test(o)?this.#fullpathPosix=`//?/${o}`:this.#fullpathPosix=o}let o=this.parent,A=o.fullpathPosix();return this.#fullpathPosix=A+(!A||!o.parent?``:`/`)+this.name}isUnknown(){return(this.#type&15)==0}isType(o){return this[`is${o}`]()}getType(){return this.isUnknown()?`Unknown`:this.isDirectory()?`Directory`:this.isFile()?`File`:this.isSymbolicLink()?`SymbolicLink`:this.isFIFO()?`FIFO`:this.isCharacterDevice()?`CharacterDevice`:this.isBlockDevice()?`BlockDevice`:this.isSocket()?`Socket`:`Unknown`}isFile(){return(this.#type&15)==8}isDirectory(){return(this.#type&15)==4}isCharacterDevice(){return(this.#type&15)==2}isBlockDevice(){return(this.#type&15)==6}isFIFO(){return(this.#type&15)==1}isSocket(){return(this.#type&15)==12}isSymbolicLink(){return(this.#type&10)==10}lstatCached(){return this.#type&32?this:void 0}readlinkCached(){return this.#linkTarget}realpathCached(){return this.#realpath}readdirCached(){let o=this.children();return o.slice(0,o.provisional)}canReadlink(){if(this.#linkTarget)return!0;if(!this.parent)return!1;let o=this.#type&15;return!(o!==0&&o!==10||this.#type&256||this.#type&128)}calledReaddir(){return!!(this.#type&16)}isENOENT(){return!!(this.#type&128)}isNamed(o){return this.nocase?this.#matchName===normalizeNocase(o):this.#matchName===normalize(o)}async readlink(){let o=this.#linkTarget;if(o)return o;if(this.canReadlink()&&this.parent)try{let o=await this.#fs.promises.readlink(this.fullpath()),A=(await this.parent.realpath())?.resolve(o);if(A)return this.#linkTarget=A}catch(o){this.#readlinkFail(o.code);return}}readlinkSync(){let o=this.#linkTarget;if(o)return o;if(this.canReadlink()&&this.parent)try{let o=this.#fs.readlinkSync(this.fullpath()),A=this.parent.realpathSync()?.resolve(o);if(A)return this.#linkTarget=A}catch(o){this.#readlinkFail(o.code);return}}#readdirSuccess(o){this.#type|=16;for(let A=o.provisional;A<o.length;A++){let j=o[A];j&&j.#markENOENT()}}#markENOENT(){this.#type&128||(this.#type=(this.#type|128)&-16,this.#markChildrenENOENT())}#markChildrenENOENT(){let o=this.children();o.provisional=0;for(let A of o)A.#markENOENT()}#markENOREALPATH(){this.#type|=512,this.#markENOTDIR()}#markENOTDIR(){if(this.#type&64)return;let o=this.#type;(o&15)==4&&(o&=-16),this.#type=o|64,this.#markChildrenENOENT()}#readdirFail(o=``){o===`ENOTDIR`||o===`EPERM`?this.#markENOTDIR():o===`ENOENT`?this.#markENOENT():this.children().provisional=0}#lstatFail(o=``){o===`ENOTDIR`?this.parent.#markENOTDIR():o===`ENOENT`&&this.#markENOENT()}#readlinkFail(o=``){let A=this.#type;A|=256,o===`ENOENT`&&(A|=128),(o===`EINVAL`||o===`UNKNOWN`)&&(A&=-16),this.#type=A,o===`ENOTDIR`&&this.parent&&this.parent.#markENOTDIR()}#readdirAddChild(o,A){return this.#readdirMaybePromoteChild(o,A)||this.#readdirAddNewChild(o,A)}#readdirAddNewChild(o,A){let j=entToType(o),M=this.newChild(o.name,j,{parent:this}),N=M.#type&15;return N!==4&&N!==10&&N!==0&&(M.#type|=64),A.unshift(M),A.provisional++,M}#readdirMaybePromoteChild(o,A){for(let j=A.provisional;j<A.length;j++){let M=A[j];if((this.nocase?normalizeNocase(o.name):normalize(o.name))===M.#matchName)return this.#readdirPromoteChild(o,M,j,A)}}#readdirPromoteChild(o,A,j,M){let N=A.name;return A.#type=A.#type&-16|entToType(o),N!==o.name&&(A.name=o.name),j!==M.provisional&&(j===M.length-1?M.pop():M.splice(j,1),M.unshift(A)),M.provisional++,A}async lstat(){if(!(this.#type&128))try{return this.#applyStat(await this.#fs.promises.lstat(this.fullpath())),this}catch(o){this.#lstatFail(o.code)}}lstatSync(){if(!(this.#type&128))try{return this.#applyStat(this.#fs.lstatSync(this.fullpath())),this}catch(o){this.#lstatFail(o.code)}}#applyStat(o){let{atime:A,atimeMs:j,birthtime:M,birthtimeMs:N,blksize:P,blocks:F,ctime:I,ctimeMs:L,dev:R,gid:z,ino:B,mode:V,mtime:H,mtimeMs:U,nlink:W,rdev:G,size:K,uid:q}=o;this.#atime=A,this.#atimeMs=j,this.#birthtime=M,this.#birthtimeMs=N,this.#blksize=P,this.#blocks=F,this.#ctime=I,this.#ctimeMs=L,this.#dev=R,this.#gid=z,this.#ino=B,this.#mode=V,this.#mtime=H,this.#mtimeMs=U,this.#nlink=W,this.#rdev=G,this.#size=K,this.#uid=q;let J=entToType(o);this.#type=this.#type&-16|J|32,J!==0&&J!==4&&J!==10&&(this.#type|=64)}#onReaddirCB=[];#readdirCBInFlight=!1;#callOnReaddirCB(o){this.#readdirCBInFlight=!1;let A=this.#onReaddirCB.slice();this.#onReaddirCB.length=0,A.forEach(A=>A(null,o))}readdirCB(o,A=!1){if(!this.canReaddir()){A?o(null,[]):queueMicrotask(()=>o(null,[]));return}let j=this.children();if(this.calledReaddir()){let M=j.slice(0,j.provisional);A?o(null,M):queueMicrotask(()=>o(null,M));return}if(this.#onReaddirCB.push(o),this.#readdirCBInFlight)return;this.#readdirCBInFlight=!0;let M=this.fullpath();this.#fs.readdir(M,{withFileTypes:!0},(o,A)=>{if(o)this.#readdirFail(o.code),j.provisional=0;else{for(let o of A)this.#readdirAddChild(o,j);this.#readdirSuccess(j)}this.#callOnReaddirCB(j.slice(0,j.provisional))})}#asyncReaddirInFlight;async readdir(){if(!this.canReaddir())return[];let o=this.children();if(this.calledReaddir())return o.slice(0,o.provisional);let A=this.fullpath();if(this.#asyncReaddirInFlight)await this.#asyncReaddirInFlight;else{let j=()=>{};this.#asyncReaddirInFlight=new Promise(o=>j=o);try{for(let j of await this.#fs.promises.readdir(A,{withFileTypes:!0}))this.#readdirAddChild(j,o);this.#readdirSuccess(o)}catch(A){this.#readdirFail(A.code),o.provisional=0}this.#asyncReaddirInFlight=void 0,j()}return o.slice(0,o.provisional)}readdirSync(){if(!this.canReaddir())return[];let o=this.children();if(this.calledReaddir())return o.slice(0,o.provisional);let A=this.fullpath();try{for(let j of this.#fs.readdirSync(A,{withFileTypes:!0}))this.#readdirAddChild(j,o);this.#readdirSuccess(o)}catch(A){this.#readdirFail(A.code),o.provisional=0}return o.slice(0,o.provisional)}canReaddir(){if(this.#type&704)return!1;let o=15&this.#type;return o===0||o===4||o===10}shouldWalk(o,A){return(this.#type&4)==4&&!(this.#type&704)&&!o.has(this)&&(!A||A(this))}async realpath(){if(this.#realpath)return this.#realpath;if(!(896&this.#type))try{let o=await this.#fs.promises.realpath(this.fullpath());return this.#realpath=this.resolve(o)}catch{this.#markENOREALPATH()}}realpathSync(){if(this.#realpath)return this.#realpath;if(!(896&this.#type))try{let o=this.#fs.realpathSync(this.fullpath());return this.#realpath=this.resolve(o)}catch{this.#markENOREALPATH()}}[setAsCwd](o){if(o===this)return;o.isCWD=!1,this.isCWD=!0;let A=new Set([]),j=[],M=this;for(;M&&M.parent;)A.add(M),M.#relative=j.join(this.sep),M.#relativePosix=j.join(`/`),M=M.parent,j.push(`..`);for(M=o;M&&M.parent&&!A.has(M);)M.#relative=void 0,M.#relativePosix=void 0,M=M.parent}}exports.PathBase=PathBase;class PathWin32 extends PathBase{sep=`\\`;splitSep=eitherSep;constructor(o,A=0,j,M,N,P,F){super(o,A,j,M,N,P,F)}newChild(o,A=0,j={}){return new PathWin32(o,A,this.root,this.roots,this.nocase,this.childrenCache(),j)}getRootString(o){return node_path_1.win32.parse(o).root}getRoot(o){if(o=uncToDrive(o.toUpperCase()),o===this.root.name)return this.root;for(let[A,j]of Object.entries(this.roots))if(this.sameRoot(o,A))return this.roots[o]=j;return this.roots[o]=new PathScurryWin32(o,this).root}sameRoot(o,A=this.root.name){return o=o.toUpperCase().replace(/\//g,`\\`).replace(uncDriveRegexp,`$1\\`),o===A}}exports.PathWin32=PathWin32;class PathPosix extends PathBase{splitSep=`/`;sep=`/`;constructor(o,A=0,j,M,N,P,F){super(o,A,j,M,N,P,F)}getRootString(o){return o.startsWith(`/`)?`/`:``}getRoot(o){return this.root}newChild(o,A=0,j={}){return new PathPosix(o,A,this.root,this.roots,this.nocase,this.childrenCache(),j)}}exports.PathPosix=PathPosix;class PathScurryBase{root;rootPath;roots;cwd;#resolveCache;#resolvePosixCache;#children;nocase;#fs;constructor(o=process.cwd(),A,j,{nocase:M,childrenCacheSize:N=16*1024,fs:F=defaultFS}={}){this.#fs=fsFromOption(F),(o instanceof URL||o.startsWith(`file://`))&&(o=(0,node_url_1.fileURLToPath)(o));let I=A.resolve(o);this.roots=Object.create(null),this.rootPath=this.parseRootPath(I),this.#resolveCache=new ResolveCache,this.#resolvePosixCache=new ResolveCache,this.#children=new ChildrenCache(N);let L=I.substring(this.rootPath.length).split(j);if(L.length===1&&!L[0]&&L.pop(),M===void 0)throw TypeError(`must provide nocase setting to PathScurryBase ctor`);this.nocase=M,this.root=this.newRoot(this.#fs),this.roots[this.rootPath]=this.root;let R=this.root,z=L.length-1,H=A.sep,U=this.rootPath,W=!1;for(let o of L){let A=z--;R=R.child(o,{relative:Array(A).fill(`..`).join(H),relativePosix:Array(A).fill(`..`).join(`/`),fullpath:U+=(W?``:H)+o}),W=!0}this.cwd=R}depth(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.depth()}childrenCache(){return this.#children}resolve(...o){let A=``;for(let j=o.length-1;j>=0;j--){let M=o[j];if(!(!M||M===`.`)&&(A=A?`${M}/${A}`:M,this.isAbsolute(M)))break}let j=this.#resolveCache.get(A);if(j!==void 0)return j;let M=this.cwd.resolve(A).fullpath();return this.#resolveCache.set(A,M),M}resolvePosix(...o){let A=``;for(let j=o.length-1;j>=0;j--){let M=o[j];if(!(!M||M===`.`)&&(A=A?`${M}/${A}`:M,this.isAbsolute(M)))break}let j=this.#resolvePosixCache.get(A);if(j!==void 0)return j;let M=this.cwd.resolve(A).fullpathPosix();return this.#resolvePosixCache.set(A,M),M}relative(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.relative()}relativePosix(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.relativePosix()}basename(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.name}dirname(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),(o.parent||o).fullpath()}async readdir(o=this.cwd,A={withFileTypes:!0}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j}=A;if(o.canReaddir()){let A=await o.readdir();return j?A:A.map(o=>o.name)}else return[]}readdirSync(o=this.cwd,A={withFileTypes:!0}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0}=A;return o.canReaddir()?j?o.readdirSync():o.readdirSync().map(o=>o.name):[]}async lstat(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.lstat()}lstatSync(o=this.cwd){return typeof o==`string`&&(o=this.cwd.resolve(o)),o.lstatSync()}async readlink(o=this.cwd,{withFileTypes:A}={withFileTypes:!1}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o.withFileTypes,o=this.cwd);let j=await o.readlink();return A?j:j?.fullpath()}readlinkSync(o=this.cwd,{withFileTypes:A}={withFileTypes:!1}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o.withFileTypes,o=this.cwd);let j=o.readlinkSync();return A?j:j?.fullpath()}async realpath(o=this.cwd,{withFileTypes:A}={withFileTypes:!1}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o.withFileTypes,o=this.cwd);let j=await o.realpath();return A?j:j?.fullpath()}realpathSync(o=this.cwd,{withFileTypes:A}={withFileTypes:!1}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o.withFileTypes,o=this.cwd);let j=o.realpathSync();return A?j:j?.fullpath()}async walk(o=this.cwd,A={}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0,follow:M=!1,filter:N,walkFilter:P}=A,F=[];(!N||N(o))&&F.push(j?o:o.fullpath());let I=new Set,L=(o,A)=>{I.add(o),o.readdirCB((o,R)=>{if(o)return A(o);let z=R.length;if(!z)return A();let B=()=>{--z===0&&A()};for(let o of R)(!N||N(o))&&F.push(j?o:o.fullpath()),M&&o.isSymbolicLink()?o.realpath().then(o=>o?.isUnknown()?o.lstat():o).then(o=>o?.shouldWalk(I,P)?L(o,B):B()):o.shouldWalk(I,P)?L(o,B):B()},!0)},R=o;return new Promise((o,A)=>{L(R,j=>{if(j)return A(j);o(F)})})}walkSync(o=this.cwd,A={}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0,follow:M=!1,filter:N,walkFilter:P}=A,F=[];(!N||N(o))&&F.push(j?o:o.fullpath());let I=new Set([o]);for(let o of I){let A=o.readdirSync();for(let o of A){(!N||N(o))&&F.push(j?o:o.fullpath());let A=o;if(o.isSymbolicLink()){if(!(M&&(A=o.realpathSync())))continue;A.isUnknown()&&A.lstatSync()}A.shouldWalk(I,P)&&I.add(A)}}return F}[Symbol.asyncIterator](){return this.iterate()}iterate(o=this.cwd,A={}){return typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd),this.stream(o,A)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(o=this.cwd,A={}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0,follow:M=!1,filter:N,walkFilter:P}=A;(!N||N(o))&&(yield j?o:o.fullpath());let F=new Set([o]);for(let o of F){let A=o.readdirSync();for(let o of A){(!N||N(o))&&(yield j?o:o.fullpath());let A=o;if(o.isSymbolicLink()){if(!(M&&(A=o.realpathSync())))continue;A.isUnknown()&&A.lstatSync()}A.shouldWalk(F,P)&&F.add(A)}}}stream(o=this.cwd,A={}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0,follow:M=!1,filter:N,walkFilter:P}=A,F=new minipass_1.Minipass({objectMode:!0});(!N||N(o))&&F.write(j?o:o.fullpath());let I=new Set,L=[o],R=0,B=()=>{let o=!1;for(;!o;){let A=L.shift();if(!A){R===0&&F.end();return}R++,I.add(A);let z=(A,H,U=!1)=>{if(A)return F.emit(`error`,A);if(M&&!U){let o=[];for(let A of H)A.isSymbolicLink()&&o.push(A.realpath().then(o=>o?.isUnknown()?o.lstat():o));if(o.length){Promise.all(o).then(()=>z(null,H,!0));return}}for(let A of H)A&&(!N||N(A))&&(F.write(j?A:A.fullpath())||(o=!0));R--;for(let o of H){let A=o.realpathCached()||o;A.shouldWalk(I,P)&&L.push(A)}o&&!F.flowing?F.once(`drain`,B):V||B()},V=!0;A.readdirCB(z,!0),V=!1}};return B(),F}streamSync(o=this.cwd,A={}){typeof o==`string`?o=this.cwd.resolve(o):o instanceof PathBase||(A=o,o=this.cwd);let{withFileTypes:j=!0,follow:M=!1,filter:N,walkFilter:P}=A,F=new minipass_1.Minipass({objectMode:!0}),I=new Set;(!N||N(o))&&F.write(j?o:o.fullpath());let L=[o],R=0,B=()=>{let o=!1;for(;!o;){let A=L.shift();if(!A){R===0&&F.end();return}R++,I.add(A);let z=A.readdirSync();for(let A of z)(!N||N(A))&&(F.write(j?A:A.fullpath())||(o=!0));R--;for(let o of z){let A=o;if(o.isSymbolicLink()){if(!(M&&(A=o.realpathSync())))continue;A.isUnknown()&&A.lstatSync()}A.shouldWalk(I,P)&&L.push(A)}}o&&!F.flowing&&F.once(`drain`,B)};return B(),F}chdir(o=this.cwd){let A=this.cwd;this.cwd=typeof o==`string`?this.cwd.resolve(o):o,this.cwd[setAsCwd](A)}}exports.PathScurryBase=PathScurryBase;class PathScurryWin32 extends PathScurryBase{sep=`\\`;constructor(o=process.cwd(),A={}){let{nocase:j=!0}=A;super(o,node_path_1.win32,`\\`,{...A,nocase:j}),this.nocase=j;for(let o=this.cwd;o;o=o.parent)o.nocase=this.nocase}parseRootPath(o){return node_path_1.win32.parse(o).root.toUpperCase()}newRoot(o){return new PathWin32(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:o})}isAbsolute(o){return o.startsWith(`/`)||o.startsWith(`\\`)||/^[a-z]:(\/|\\)/i.test(o)}}exports.PathScurryWin32=PathScurryWin32;class PathScurryPosix extends PathScurryBase{sep=`/`;constructor(o=process.cwd(),A={}){let{nocase:j=!1}=A;super(o,node_path_1.posix,`/`,{...A,nocase:j}),this.nocase=j}parseRootPath(o){return`/`}newRoot(o){return new PathPosix(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:o})}isAbsolute(o){return o.startsWith(`/`)}}exports.PathScurryPosix=PathScurryPosix;class PathScurryDarwin extends PathScurryPosix{constructor(o=process.cwd(),A={}){let{nocase:j=!0}=A;super(o,{...A,nocase:j})}}exports.PathScurryDarwin=PathScurryDarwin,exports.Path=process.platform===`win32`?PathWin32:PathPosix,exports.PathScurry=process.platform===`win32`?PathScurryWin32:process.platform===`darwin`?PathScurryDarwin:PathScurryPosix;