"use strict";var __importDefault=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(exports,`__esModule`,{value:!0}),exports.unescape=exports.escape=exports.AST=exports.Minimatch=exports.match=exports.makeRe=exports.braceExpand=exports.defaults=exports.filter=exports.GLOBSTAR=exports.sep=exports.minimatch=void 0;const brace_expansion_1=__importDefault(require(`brace-expansion`)),assert_valid_pattern_js_1=require(`./assert-valid-pattern.js`),ast_js_1=require(`./ast.js`),escape_js_1=require(`./escape.js`),unescape_js_1=require(`./unescape.js`),minimatch=(c,M,P={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(M),!P.nocomment&&M.charAt(0)===`#`?!1:new Minimatch(M,P).match(c));exports.minimatch=minimatch;const starDotExtRE=/^\*+([^+@!?\*\[\(]*)$/,starDotExtTest=c=>M=>!M.startsWith(`.`)&&M.endsWith(c),starDotExtTestDot=c=>M=>M.endsWith(c),starDotExtTestNocase=c=>(c=c.toLowerCase(),M=>!M.startsWith(`.`)&&M.toLowerCase().endsWith(c)),starDotExtTestNocaseDot=c=>(c=c.toLowerCase(),M=>M.toLowerCase().endsWith(c)),starDotStarRE=/^\*+\.\*+$/,starDotStarTest=c=>!c.startsWith(`.`)&&c.includes(`.`),starDotStarTestDot=c=>c!==`.`&&c!==`..`&&c.includes(`.`),dotStarRE=/^\.\*+$/,dotStarTest=c=>c!==`.`&&c!==`..`&&c.startsWith(`.`),starRE=/^\*+$/,starTest=c=>c.length!==0&&!c.startsWith(`.`),starTestDot=c=>c.length!==0&&c!==`.`&&c!==`..`,qmarksRE=/^\?+([^+@!?\*\[\(]*)?$/,qmarksTestNocase=([c,M=``])=>{let N=qmarksTestNoExt([c]);return M?(M=M.toLowerCase(),c=>N(c)&&c.toLowerCase().endsWith(M)):N},qmarksTestNocaseDot=([c,M=``])=>{let N=qmarksTestNoExtDot([c]);return M?(M=M.toLowerCase(),c=>N(c)&&c.toLowerCase().endsWith(M)):N},qmarksTestDot=([c,M=``])=>{let N=qmarksTestNoExtDot([c]);return M?c=>N(c)&&c.endsWith(M):N},qmarksTest=([c,M=``])=>{let N=qmarksTestNoExt([c]);return M?c=>N(c)&&c.endsWith(M):N},qmarksTestNoExt=([c])=>{let M=c.length;return c=>c.length===M&&!c.startsWith(`.`)},qmarksTestNoExtDot=([c])=>{let M=c.length;return c=>c.length===M&&c!==`.`&&c!==`..`},defaultPlatform=typeof process==`object`&&process?typeof process.env==`object`&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:`posix`,path={win32:{sep:`\\`},posix:{sep:`/`}};exports.sep=defaultPlatform===`win32`?path.win32.sep:path.posix.sep,exports.minimatch.sep=exports.sep,exports.GLOBSTAR=Symbol(`globstar **`),exports.minimatch.GLOBSTAR=exports.GLOBSTAR;const qmark=`[^/]`,star=`[^/]*?`,twoStarDot=`(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?`,twoStarNoDot=`(?:(?!(?:\\/|^)\\.).)*?`,filter=(c,M={})=>N=>(0,exports.minimatch)(N,c,M);exports.filter=filter,exports.minimatch.filter=exports.filter;const ext=(c,M={})=>Object.assign({},c,M),defaults=c=>{if(!c||typeof c!=`object`||!Object.keys(c).length)return exports.minimatch;let M=exports.minimatch;return Object.assign((N,P,F={})=>M(N,P,ext(c,F)),{Minimatch:class extends M.Minimatch{constructor(M,N={}){super(M,ext(c,N))}static defaults(N){return M.defaults(ext(c,N)).Minimatch}},AST:class extends M.AST{constructor(M,N,P={}){super(M,N,ext(c,P))}static fromGlob(N,P={}){return M.AST.fromGlob(N,ext(c,P))}},unescape:(N,P={})=>M.unescape(N,ext(c,P)),escape:(N,P={})=>M.escape(N,ext(c,P)),filter:(N,P={})=>M.filter(N,ext(c,P)),defaults:N=>M.defaults(ext(c,N)),makeRe:(N,P={})=>M.makeRe(N,ext(c,P)),braceExpand:(N,P={})=>M.braceExpand(N,ext(c,P)),match:(N,P,F={})=>M.match(N,P,ext(c,F)),sep:M.sep,GLOBSTAR:exports.GLOBSTAR})};exports.defaults=defaults,exports.minimatch.defaults=exports.defaults;const braceExpand=(c,P={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(c),P.nobrace||!/\{(?:(?!\{).)*\}/.test(c)?[c]:(0,brace_expansion_1.default)(c));exports.braceExpand=braceExpand,exports.minimatch.braceExpand=exports.braceExpand;const makeRe=(c,M={})=>new Minimatch(c,M).makeRe();exports.makeRe=makeRe,exports.minimatch.makeRe=exports.makeRe;const match=(c,M,N={})=>{let P=new Minimatch(M,N);return c=c.filter(c=>P.match(c)),P.options.nonull&&!c.length&&c.push(M),c};exports.match=match,exports.minimatch.match=exports.match;const globMagic=/[?*]|[+@!]\(.*?\)|\[|\]/,regExpEscape=c=>c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,`\\$&`);class Minimatch{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(c,M={}){(0,assert_valid_pattern_js_1.assertValidPattern)(c),M||={},this.options=M,this.pattern=c,this.platform=M.platform||defaultPlatform,this.isWindows=this.platform===`win32`,this.windowsPathsNoEscape=!!M.windowsPathsNoEscape||M.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,`/`)),this.preserveMultipleSlashes=!!M.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!M.nonegate,this.comment=!1,this.empty=!1,this.partial=!!M.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=M.windowsNoMagicRoot===void 0?!!(this.isWindows&&this.nocase):M.windowsNoMagicRoot,this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let c of this.set)for(let M of c)if(typeof M!=`string`)return!0;return!1}debug(...c){}make(){let c=this.pattern,M=this.options;if(!M.nocomment&&c.charAt(0)===`#`){this.comment=!0;return}if(!c){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],M.debug&&(this.debug=(...c)=>console.error(...c)),this.debug(this.pattern,this.globSet);let N=this.globSet.map(c=>this.slashSplit(c));this.globParts=this.preprocess(N),this.debug(this.pattern,this.globParts);let P=this.globParts.map((c,M,N)=>{if(this.isWindows&&this.windowsNoMagicRoot){let M=c[0]===``&&c[1]===``&&(c[2]===`?`||!globMagic.test(c[2]))&&!globMagic.test(c[3]),N=/^[a-z]:/i.test(c[0]);if(M)return[...c.slice(0,4),...c.slice(4).map(c=>this.parse(c))];if(N)return[c[0],...c.slice(1).map(c=>this.parse(c))]}return c.map(c=>this.parse(c))});if(this.debug(this.pattern,P),this.set=P.filter(c=>c.indexOf(!1)===-1),this.isWindows)for(let c=0;c<this.set.length;c++){let M=this.set[c];M[0]===``&&M[1]===``&&this.globParts[c][2]===`?`&&typeof M[3]==`string`&&/^[a-z]:$/i.test(M[3])&&(M[2]=`?`)}this.debug(this.pattern,this.set)}preprocess(c){if(this.options.noglobstar)for(let M=0;M<c.length;M++)for(let N=0;N<c[M].length;N++)c[M][N]===`**`&&(c[M][N]=`*`);let{optimizationLevel:M=1}=this.options;return M>=2?(c=this.firstPhasePreProcess(c),c=this.secondPhasePreProcess(c)):c=M>=1?this.levelOneOptimize(c):this.adjascentGlobstarOptimize(c),c}adjascentGlobstarOptimize(c){return c.map(c=>{let M=-1;for(;(M=c.indexOf(`**`,M+1))!==-1;){let N=M;for(;c[N+1]===`**`;)N++;N!==M&&c.splice(M,N-M)}return c})}levelOneOptimize(c){return c.map(c=>(c=c.reduce((c,M)=>{let N=c[c.length-1];return M===`**`&&N===`**`?c:M===`..`&&N&&N!==`..`&&N!==`.`&&N!==`**`?(c.pop(),c):(c.push(M),c)},[]),c.length===0?[``]:c))}levelTwoFileOptimize(c){Array.isArray(c)||(c=this.slashSplit(c));let M=!1;do{if(M=!1,!this.preserveMultipleSlashes){for(let N=1;N<c.length-1;N++){let P=c[N];N===1&&P===``&&c[0]===``||(P===`.`||P===``)&&(M=!0,c.splice(N,1),N--)}c[0]===`.`&&c.length===2&&(c[1]===`.`||c[1]===``)&&(M=!0,c.pop())}let N=0;for(;(N=c.indexOf(`..`,N+1))!==-1;){let P=c[N-1];P&&P!==`.`&&P!==`..`&&P!==`**`&&(M=!0,c.splice(N-1,2),N-=2)}}while(M);return c.length===0?[``]:c}firstPhasePreProcess(c){let M=!1;do{M=!1;for(let N of c){let P=-1;for(;(P=N.indexOf(`**`,P+1))!==-1;){let F=P;for(;N[F+1]===`**`;)F++;F>P&&N.splice(P+1,F-P);let I=N[P+1],L=N[P+2],R=N[P+3];if(I!==`..`||!L||L===`.`||L===`..`||!R||R===`.`||R===`..`)continue;M=!0,N.splice(P,1);let z=N.slice(0);z[P]=`**`,c.push(z),P--}if(!this.preserveMultipleSlashes){for(let c=1;c<N.length-1;c++){let P=N[c];c===1&&P===``&&N[0]===``||(P===`.`||P===``)&&(M=!0,N.splice(c,1),c--)}N[0]===`.`&&N.length===2&&(N[1]===`.`||N[1]===``)&&(M=!0,N.pop())}let F=0;for(;(F=N.indexOf(`..`,F+1))!==-1;){let c=N[F-1];if(c&&c!==`.`&&c!==`..`&&c!==`**`){M=!0;let c=F===1&&N[F+1]===`**`?[`.`]:[];N.splice(F-1,2,...c),N.length===0&&N.push(``),F-=2}}}}while(M);return c}secondPhasePreProcess(c){for(let M=0;M<c.length-1;M++)for(let N=M+1;N<c.length;N++){let P=this.partsMatch(c[M],c[N],!this.preserveMultipleSlashes);if(P){c[M]=[],c[N]=P;break}}return c.filter(c=>c.length)}partsMatch(c,M,N=!1){let P=0,F=0,I=[],L=``;for(;P<c.length&&F<M.length;)if(c[P]===M[F])I.push(L===`b`?M[F]:c[P]),P++,F++;else if(N&&c[P]===`**`&&M[F]===c[P+1])I.push(c[P]),P++;else if(N&&M[F]===`**`&&c[P]===M[F+1])I.push(M[F]),F++;else if(c[P]===`*`&&M[F]&&(this.options.dot||!M[F].startsWith(`.`))&&M[F]!==`**`){if(L===`b`)return!1;L=`a`,I.push(c[P]),P++,F++}else if(M[F]===`*`&&c[P]&&(this.options.dot||!c[P].startsWith(`.`))&&c[P]!==`**`){if(L===`a`)return!1;L=`b`,I.push(M[F]),P++,F++}else return!1;return c.length===M.length&&I}parseNegate(){if(this.nonegate)return;let c=this.pattern,M=!1,N=0;for(let P=0;P<c.length&&c.charAt(P)===`!`;P++)M=!M,N++;N&&(this.pattern=c.slice(N)),this.negate=M}matchOne(c,M,N=!1){let P=this.options;if(this.isWindows){let N=typeof c[0]==`string`&&/^[a-z]:$/i.test(c[0]),P=!N&&c[0]===``&&c[1]===``&&c[2]===`?`&&/^[a-z]:$/i.test(c[3]),F=typeof M[0]==`string`&&/^[a-z]:$/i.test(M[0]),I=!F&&M[0]===``&&M[1]===``&&M[2]===`?`&&typeof M[3]==`string`&&/^[a-z]:$/i.test(M[3]),L=P?3:N?0:void 0,R=I?3:F?0:void 0;if(typeof L==`number`&&typeof R==`number`){let[N,P]=[c[L],M[R]];N.toLowerCase()===P.toLowerCase()&&(M[R]=N,R>L?M=M.slice(R):L>R&&(c=c.slice(L)))}}let{optimizationLevel:F=1}=this.options;F>=2&&(c=this.levelTwoFileOptimize(c)),this.debug(`matchOne`,this,{file:c,pattern:M}),this.debug(`matchOne`,c.length,M.length);for(var I=0,L=0,R=c.length,z=M.length;I<R&&L<z;I++,L++){this.debug(`matchOne loop`);var B=M[L],V=c[I];if(this.debug(M,B,V),B===!1)return!1;if(B===exports.GLOBSTAR){this.debug(`GLOBSTAR`,[M,B,V]);var H=I,U=L+1;if(U===z){for(this.debug(`** at the end`);I<R;I++)if(c[I]===`.`||c[I]===`..`||!P.dot&&c[I].charAt(0)===`.`)return!1;return!0}for(;H<R;){var W=c[H];if(this.debug(`
globstar while`,c,H,M,U,W),this.matchOne(c.slice(H),M.slice(U),N))return this.debug(`globstar found match!`,H,R,W),!0;if(W===`.`||W===`..`||!P.dot&&W.charAt(0)===`.`){this.debug(`dot detected!`,c,H,M,U);break}this.debug(`globstar swallow a segment, and continue`),H++}return!!(N&&(this.debug(`
>>> no match, partial?`,c,H,M,U),H===R))}let F;if(typeof B==`string`?(F=V===B,this.debug(`string match`,B,V,F)):(F=B.test(V),this.debug(`pattern match`,B,V,F)),!F)return!1}if(I===R&&L===z)return!0;if(I===R)return N;if(L===z)return I===R-1&&c[I]===``;throw Error(`wtf?`)}braceExpand(){return(0,exports.braceExpand)(this.pattern,this.options)}parse(c){(0,assert_valid_pattern_js_1.assertValidPattern)(c);let M=this.options;if(c===`**`)return exports.GLOBSTAR;if(c===``)return``;let F,I=null;(F=c.match(starRE))?I=M.dot?starTestDot:starTest:(F=c.match(starDotExtRE))?I=(M.nocase?M.dot?starDotExtTestNocaseDot:starDotExtTestNocase:M.dot?starDotExtTestDot:starDotExtTest)(F[1]):(F=c.match(qmarksRE))?I=(M.nocase?M.dot?qmarksTestNocaseDot:qmarksTestNocase:M.dot?qmarksTestDot:qmarksTest)(F):(F=c.match(starDotStarRE))?I=M.dot?starDotStarTestDot:starDotStarTest:(F=c.match(dotStarRE))&&(I=dotStarTest);let L=ast_js_1.AST.fromGlob(c,this.options).toMMPattern();return I&&typeof L==`object`&&Reflect.defineProperty(L,`test`,{value:I}),L}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let c=this.set;if(!c.length)return this.regexp=!1,this.regexp;let M=this.options,N=M.noglobstar?`[^/]*?`:M.dot?`(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?`:`(?:(?!(?:\\/|^)\\.).)*?`,P=new Set(M.nocase?[`i`]:[]),F=c.map(c=>{let M=c.map(c=>{if(c instanceof RegExp)for(let M of c.flags.split(``))P.add(M);return typeof c==`string`?regExpEscape(c):c===exports.GLOBSTAR?exports.GLOBSTAR:c._src});return M.forEach((c,P)=>{let F=M[P+1],I=M[P-1];c!==exports.GLOBSTAR||I===exports.GLOBSTAR||(I===void 0?F!==void 0&&F!==exports.GLOBSTAR?M[P+1]=`(?:\\/|`+N+`\\/)?`+F:M[P]=N:F===void 0?M[P-1]=I+`(?:\\/|`+N+`)?`:F!==exports.GLOBSTAR&&(M[P-1]=I+`(?:\\/|\\/`+N+`\\/)`+F,M[P+1]=exports.GLOBSTAR))}),M.filter(c=>c!==exports.GLOBSTAR).join(`/`)}).join(`|`),[I,L]=c.length>1?[`(?:`,`)`]:[``,``];F=`^`+I+F+L+`$`,this.negate&&(F=`^(?!`+F+`).+$`);try{this.regexp=new RegExp(F,[...P].join(``))}catch{this.regexp=!1}return this.regexp}slashSplit(c){return this.preserveMultipleSlashes?c.split(`/`):this.isWindows&&/^\/\/[^\/]+/.test(c)?[``,...c.split(/\/+/)]:c.split(/\/+/)}match(c,M=this.partial){if(this.debug(`match`,c,this.pattern),this.comment)return!1;if(this.empty)return c===``;if(c===`/`&&M)return!0;let N=this.options;this.isWindows&&(c=c.split(`\\`).join(`/`));let P=this.slashSplit(c);this.debug(this.pattern,`split`,P);let F=this.set;this.debug(this.pattern,`set`,F);let I=P[P.length-1];if(!I)for(let c=P.length-2;!I&&c>=0;c--)I=P[c];for(let c=0;c<F.length;c++){let L=F[c],R=P;if(N.matchBase&&L.length===1&&(R=[I]),this.matchOne(R,L,M))return N.flipNegate?!0:!this.negate}return N.flipNegate?!1:this.negate}static defaults(c){return exports.minimatch.defaults(c).Minimatch}}exports.Minimatch=Minimatch;var ast_js_2=require(`./ast.js`);Object.defineProperty(exports,`AST`,{enumerable:!0,get:function(){return ast_js_2.AST}});var escape_js_2=require(`./escape.js`);Object.defineProperty(exports,`escape`,{enumerable:!0,get:function(){return escape_js_2.escape}});var unescape_js_2=require(`./unescape.js`);Object.defineProperty(exports,`unescape`,{enumerable:!0,get:function(){return unescape_js_2.unescape}}),exports.minimatch.AST=ast_js_1.AST,exports.minimatch.Minimatch=Minimatch,exports.minimatch.escape=escape_js_1.escape,exports.minimatch.unescape=unescape_js_1.unescape;