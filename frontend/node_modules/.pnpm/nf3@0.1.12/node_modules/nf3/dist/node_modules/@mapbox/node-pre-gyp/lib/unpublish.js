"use strict";module.exports=exports=unpublish,exports.usage=`Unpublishes pre-built binary (requires aws-sdk)`;const log=require(`./util/log.js`),versioning=require(`./util/versioning.js`),napi=require(`./util/napi.js`),s3_setup=require(`./util/s3_setup.js`),url=require(`url`);function unpublish(a,o,s){let c=a.package_json,l=napi.get_napi_build_version_from_command_args(o),u=versioning.evaluate(c,a.opts,l),d=s3_setup.detect(u),f=s3_setup.get_s3(d),p=url.resolve(d.prefix,u.package_name),m={Bucket:d.bucket,Key:p};f.headObject(m,(r,i)=>{if(r&&r.code===`NotFound`)return console.log(`[`+c.name+`] Not found: `+u.hosted_tarball),s();if(r)return s(r);log.info(`unpublish`,JSON.stringify(i)),f.deleteObject(m,(r,i)=>r?s(r):(log.info(JSON.stringify(i)),console.log(`[`+c.name+`] Success: removed `+u.hosted_tarball),s()))})}